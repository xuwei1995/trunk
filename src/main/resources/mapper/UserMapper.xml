<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.serviceindeed.yike.yikemo.mapper.UserMapper">
    <resultMap id="BaseResultMap" type="com.serviceindeed.yike.yikemo.domain.User">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="USER_ID" jdbcType="BIGINT" property="userId"/>
        <result column="IFK_CODE" jdbcType="VARCHAR" property="ifkCode"/>
        <result column="PASSWORD" jdbcType="VARCHAR" property="password"/>
        <result column="USER_NAME" jdbcType="VARCHAR" property="userName"/>
        <result column="MOBILE" jdbcType="VARCHAR" property="mobile"/>
        <result column="EMAIL" jdbcType="VARCHAR" property="email"/>
        <result column="GENDER" jdbcType="VARCHAR" property="gender"/>
        <result column="BIRTHDAY" jdbcType="DATE" property="birthday"/>
        <result column="REMARK" jdbcType="VARCHAR" property="remark"/>
        <result column="IS_ENABLE" jdbcType="VARCHAR" property="isEnable"/>
        <result column="USER_TYPE" jdbcType="VARCHAR" property="userType"/>
        <result column="PHOTO" jdbcType="VARCHAR" property="photo"/>
        <result column="SIGNATURE" jdbcType="VARCHAR" property="signature"/>
        <result column="CREATE_BY" jdbcType="BIGINT" property="createBy"/>
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="CREATE_PLATFORM" jdbcType="VARCHAR" property="createPlatform"/>
        <result column="CREATE_VERSION" jdbcType="VARCHAR" property="createVersion"/>
        <result column="UPDATE_BY" jdbcType="BIGINT" property="updateBy"/>
        <result column="UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate"/>
        <result column="UPDATE_PLATFORM" jdbcType="VARCHAR" property="updatePlatform"/>
        <result column="UPDATE_VERSION" jdbcType="VARCHAR" property="updateVersion"/>
        <result column="ROLE_ID" jdbcType="BIGINT" property="roleId"/>
        <result column="CREATE_NAME" jdbcType="VARCHAR" property="createName"/>
        <result column="ROLE_NAME" jdbcType="VARCHAR" property="roleName"/>
        <result column="IS_ENABLE_LABEL" jdbcType="VARCHAR" property="isEnableLabel"/>
        <result column="USER_TYPE_LABEL" jdbcType="VARCHAR" property="userTypeLabel"/>
        <result column="GENDER_LABEL" jdbcType="VARCHAR" property="genderLabel"/>
        <result column="ID_CARD" jdbcType="VARCHAR" property="idCard"/>
        <result column="TEACHER_ID" jdbcType="BIGINT" property="teacherId" />
        <result column="ORG_ID" jdbcType="BIGINT" property="orgId" />
        <result column="SCHOOL_ID" jdbcType="BIGINT" property="schoolId" />
        <result column="SCORE" jdbcType="DOUBLE" property="score" />
        <result column="DAN" jdbcType="INTEGER" property="dan" />
        <result column="ORG_NAME" jdbcType="VARCHAR" property="orgName" />
        <result column="ORG_ABBRNAME" jdbcType="VARCHAR" property="orgAbbrname"/>
        <result column="SCHOOL_NAME" jdbcType="VARCHAR" property="schoolName" />
        <result column="GENDER_NAME" jdbcType="VARCHAR" property="genderName" />
        <result column="ISENABLE_NAME" jdbcType="VARCHAR" property="isEnableName"/>
    </resultMap>
    <resultMap id="infoResultMap" type="com.serviceindeed.yike.yikemo.domain.model.UserInfo">
        <id column="USER_ID" jdbcType="BIGINT" property="userId"/>
        <result column="IFK_CODE" jdbcType="VARCHAR" property="ifkCode"/>
        <result column="USER_NAME" jdbcType="VARCHAR" property="userName"/>
        <result column="GENDER" jdbcType="VARCHAR" property="gender"/>
        <result column="USER_TYPE" jdbcType="VARCHAR" property="userType"/>
        <result column="ORG_ID" jdbcType="BIGINT" property="orgId" />
        <result column="ORG_ABBRNAME" jdbcType="VARCHAR" property="orgAbbrname"/>
        <result column="SCHOOL_ID" jdbcType="BIGINT" property="schoolId" />
        <result column="SCHOOL_NAME" jdbcType="VARCHAR" property="schoolName" />
        <result column="SCORE" jdbcType="DOUBLE" property="score" />
        <result column="DAN" jdbcType="INTEGER" property="dan" />
        <result column="GRADE_NAME" jdbcType="BIGINT" property="gradeName"/>
        <result column="PHOTO" jdbcType="VARCHAR" property="photo"/>
        <result column="SIGNATURE" jdbcType="VARCHAR" property="signature"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        USER_ID, IFK_CODE, PASSWORD, USER_NAME, MOBILE, EMAIL, GENDER, BIRTHDAY, REMARK,
        IS_ENABLE, USER_TYPE, PHOTO, SIGNATURE, CREATE_BY, CREATE_DATE, CREATE_PLATFORM,
        CREATE_VERSION, UPDATE_BY, UPDATE_DATE, UPDATE_PLATFORM, UPDATE_VERSION
    </sql>
    <select id="getAllUsers" resultMap="BaseResultMap">
        SELECT
        us.USER_ID,
        us.USER_NAME,
        us.IFK_CODE,
        role.ROLE_NAME,
        role.ROLE_ID,
        us.EMAIL,
        us.GENDER,
        us.REMARK,
        us.USER_TYPE,
        us.PHOTO,
        us.MOBILE,
        us.IS_ENABLE,
        us.CREATE_BY,
        us.CREATE_DATE,
        ge.KEY_VALUE AS IS_ENABLE_LABEL,
        us2.user_name AS CREATE_NAME,
        ge.KEY_VALUE AS USER_TYPE_LABEL
        FROM
        t_user AS us
        LEFT JOIN t_userrole AS usro ON usro.USER_ID = us .USER_ID
        LEFT JOIN t_role AS role ON role.ROLE_ID = usro.ROLE_ID
        LEFT JOIN t_general AS ge on ge.KEY_TYPE = 'IS_ENABLE'
        AND ge.KEY_CODE = us.IS_ENABLE
        LEFT JOIN t_general AS ge2 on ge2.KEY_TYPE = 'USER_TYPE'
        AND ge2.KEY_CODE = us.USER_TYPE
        LEFT JOIN t_user as us2 on us2.USER_ID=us.CREATE_BY
        WHERE 1=1
        <if test="userName !=null and userName !=''">
            AND us.USER_NAME LIKE CONCAT('%',#{userName},'%')
        </if>
        <if test="mobile !=null and mobile !='' ">
            AND us.MOBILE LIKE CONCAT('%',#{mobile},'%')
        </if>
        <if test="userType !=null and userType !=''">
            AND us.USER_TYPE =#{userType}
        </if>
        <if test="roleId !=null and roleId !=''">
            AND role.ROLE_ID =#{roleId}
        </if>
        <if test="sortField !=null and sortField !='' and sortDir !=null and sortDir!='' ">
            ORDER BY ${sortField} ${sortDir}
        </if>
        <if test="sortField ==null or sortField =='' ">
            ORDER BY us.USER_ID DESC
        </if>
    </select>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from t_user
        where USER_ID = #{userId,jdbcType=BIGINT}
    </select>
    <select id="selectByIfkCode" parameterType="java.lang.String" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from t_user
        where IFK_CODE = #{ifkCode}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from t_user
        where USER_ID = #{userId,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.serviceindeed.yike.yikemo.domain.User">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into t_user (USER_ID, IFK_CODE, PASSWORD,
        USER_NAME, MOBILE, EMAIL,
        GENDER, BIRTHDAY, REMARK,
        IS_ENABLE, USER_TYPE, PHOTO,
        SIGNATURE, CREATE_BY, CREATE_DATE,
        CREATE_PLATFORM, CREATE_VERSION, UPDATE_BY,
        UPDATE_DATE, UPDATE_PLATFORM, UPDATE_VERSION
        )
        values (#{userId,jdbcType=BIGINT}, #{ifkCode,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR},
        #{userName,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR},
        #{gender,jdbcType=VARCHAR}, #{birthday,jdbcType=DATE}, #{remark,jdbcType=VARCHAR},
        #{isEnable,jdbcType=VARCHAR}, #{userType,jdbcType=VARCHAR}, #{photo,jdbcType=VARCHAR},
        #{signature,jdbcType=VARCHAR}, #{createBy,jdbcType=BIGINT}, #{createDate,jdbcType=TIMESTAMP},
        #{createPlatform,jdbcType=VARCHAR}, #{createVersion,jdbcType=VARCHAR}, #{updateBy,jdbcType=BIGINT},
        #{updateDate,jdbcType=TIMESTAMP}, #{updatePlatform,jdbcType=VARCHAR}, #{updateVersion,jdbcType=VARCHAR}
        )
    </insert>
    <insert useGeneratedKeys="true" id="insertSelective" parameterType="com.serviceindeed.yike.yikemo.domain.User"
            keyProperty="userId">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into t_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userId != null">
                USER_ID,
            </if>
            <if test="ifkCode != null">
                IFK_CODE,
            </if>
            <if test="password != null">
                PASSWORD,
            </if>
            <if test="userName != null">
                USER_NAME,
            </if>
            <if test="mobile != null">
                MOBILE,
            </if>
            <if test="email != null">
                EMAIL,
            </if>
            <if test="gender != null">
                GENDER,
            </if>
            <if test="birthday != null">
                BIRTHDAY,
            </if>
            <if test="remark != null">
                REMARK,
            </if>
            <if test="isEnable != null">
                IS_ENABLE,
            </if>
            <if test="userType != null">
                USER_TYPE,
            </if>
            <if test="photo != null">
                PHOTO,
            </if>
            <if test="signature != null">
                SIGNATURE,
            </if>
            <if test="createBy != null">
                CREATE_BY,
            </if>
            <if test="createDate != null">
                CREATE_DATE,
            </if>
            <if test="createPlatform != null">
                CREATE_PLATFORM,
            </if>
            <if test="createVersion != null">
                CREATE_VERSION,
            </if>
            <if test="updateBy != null">
                UPDATE_BY,
            </if>
            <if test="updateDate != null">
                UPDATE_DATE,
            </if>
            <if test="updatePlatform != null">
                UPDATE_PLATFORM,
            </if>
            <if test="updateVersion != null">
                UPDATE_VERSION,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userId != null">
                #{userId,jdbcType=BIGINT},
            </if>
            <if test="ifkCode != null">
                #{ifkCode,jdbcType=VARCHAR},
            </if>
            <if test="password != null">
                #{password,jdbcType=VARCHAR},
            </if>
            <if test="userName != null">
                #{userName,jdbcType=VARCHAR},
            </if>
            <if test="mobile != null">
                #{mobile,jdbcType=VARCHAR},
            </if>
            <if test="email != null">
                #{email,jdbcType=VARCHAR},
            </if>
            <if test="gender != null">
                #{gender,jdbcType=VARCHAR},
            </if>
            <if test="birthday != null">
                #{birthday,jdbcType=DATE},
            </if>
            <if test="remark != null">
                #{remark,jdbcType=VARCHAR},
            </if>
            <if test="isEnable != null">
                #{isEnable,jdbcType=VARCHAR},
            </if>
            <if test="userType != null">
                #{userType,jdbcType=VARCHAR},
            </if>
            <if test="photo != null">
                #{photo,jdbcType=VARCHAR},
            </if>
            <if test="signature != null">
                #{signature,jdbcType=VARCHAR},
            </if>
            <if test="createBy != null">
                #{createBy,jdbcType=BIGINT},
            </if>
            <if test="createDate != null">
                #{createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="createPlatform != null">
                #{createPlatform,jdbcType=VARCHAR},
            </if>
            <if test="createVersion != null">
                #{createVersion,jdbcType=VARCHAR},
            </if>
            <if test="updateBy != null">
                #{updateBy,jdbcType=BIGINT},
            </if>
            <if test="updateDate != null">
                #{updateDate,jdbcType=TIMESTAMP},
            </if>
            <if test="updatePlatform != null">
                #{updatePlatform,jdbcType=VARCHAR},
            </if>
            <if test="updateVersion != null">
                #{updateVersion,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.serviceindeed.yike.yikemo.domain.User">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_user
        <set>
            <if test="ifkCode != null">
                IFK_CODE = #{ifkCode,jdbcType=VARCHAR},
            </if>
            <if test="password != null">
                PASSWORD = #{password,jdbcType=VARCHAR},
            </if>
            <if test="userName != null">
                USER_NAME = #{userName,jdbcType=VARCHAR},
            </if>
            <if test="mobile != null">
                MOBILE = #{mobile,jdbcType=VARCHAR},
            </if>
            <if test="email != null">
                EMAIL = #{email,jdbcType=VARCHAR},
            </if>
            <if test="gender != null">
                GENDER = #{gender,jdbcType=VARCHAR},
            </if>
            <if test="birthday != null">
                BIRTHDAY = #{birthday,jdbcType=DATE},
            </if>
            <if test="remark != null">
                REMARK = #{remark,jdbcType=VARCHAR},
            </if>
            <if test="isEnable != null">
                IS_ENABLE = #{isEnable,jdbcType=VARCHAR},
            </if>
            <if test="userType != null">
                USER_TYPE = #{userType,jdbcType=VARCHAR},
            </if>
            <if test="photo != null">
                PHOTO = #{photo,jdbcType=VARCHAR},
            </if>
            <if test="signature != null">
                SIGNATURE = #{signature,jdbcType=VARCHAR},
            </if>
            <if test="createBy != null">
                CREATE_BY = #{createBy,jdbcType=BIGINT},
            </if>
            <if test="createDate != null">
                CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="createPlatform != null">
                CREATE_PLATFORM = #{createPlatform,jdbcType=VARCHAR},
            </if>
            <if test="createVersion != null">
                CREATE_VERSION = #{createVersion,jdbcType=VARCHAR},
            </if>
            <if test="updateBy != null">
                UPDATE_BY = #{updateBy,jdbcType=BIGINT},
            </if>
            <if test="updateDate != null">
                UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
            </if>
            <if test="updatePlatform != null">
                UPDATE_PLATFORM = #{updatePlatform,jdbcType=VARCHAR},
            </if>
            <if test="updateVersion != null">
                UPDATE_VERSION = #{updateVersion,jdbcType=VARCHAR},
            </if>
        </set>
        where USER_ID = #{userId,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.serviceindeed.yike.yikemo.domain.User">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_user
        set IFK_CODE = #{ifkCode,jdbcType=VARCHAR},
        PASSWORD = #{password,jdbcType=VARCHAR},
        USER_NAME = #{userName,jdbcType=VARCHAR},
        MOBILE = #{mobile,jdbcType=VARCHAR},
        EMAIL = #{email,jdbcType=VARCHAR},
        GENDER = #{gender,jdbcType=VARCHAR},
        BIRTHDAY = #{birthday,jdbcType=DATE},
        REMARK = #{remark,jdbcType=VARCHAR},
        IS_ENABLE = #{isEnable,jdbcType=VARCHAR},
        USER_TYPE = #{userType,jdbcType=VARCHAR},
        PHOTO = #{photo,jdbcType=VARCHAR},
        SIGNATURE = #{signature,jdbcType=VARCHAR},
        CREATE_BY = #{createBy,jdbcType=BIGINT},
        CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},
        CREATE_PLATFORM = #{createPlatform,jdbcType=VARCHAR},
        CREATE_VERSION = #{createVersion,jdbcType=VARCHAR},
        UPDATE_BY = #{updateBy,jdbcType=BIGINT},
        UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
        UPDATE_PLATFORM = #{updatePlatform,jdbcType=VARCHAR},
        UPDATE_VERSION = #{updateVersion,jdbcType=VARCHAR}
        where USER_ID = #{userId,jdbcType=BIGINT}
    </update>
    <sql id="Common_Column_List">
    user_id,
	ifk_code,
	PASSWORD,
	user_name,
	mobile,
	email,
	gender,
	g.key_value AS gender_label,
	birthday,
	id_card,
	u.remark,
	u.is_enable,
	ge.key_value AS is_enable_label,
	user_type,
	gen.key_value AS user_type_label,
	photo,
	signature,
	u.create_by,
	u.create_date,
	u.create_platform,
	u.create_version,
	u.update_by,
	u.update_date,
	u.update_platform,
	u.update_version
  </sql>
    <select id="selectUserInfoById" parameterType="java.lang.Long" resultMap="BaseResultMap">
        select
        <include refid="Common_Column_List"/>
        FROM
        t_user u
        LEFT JOIN t_general g ON u.gender = g.key_code
        AND g.key_type = 'gender'
        AND g.is_enable = '1'
        LEFT JOIN t_general ge ON u.is_enable = ge.key_code
        AND ge.key_type = 'is_enable'
        AND ge.is_enable = '1'
        LEFT JOIN t_general gen ON u.user_type = gen.key_code
        AND gen.key_type = 'user_type'
        AND gen.is_enable = '1'
        where USER_ID = #{userId,jdbcType=BIGINT}
    </select>
    <!--查询平台用户信息-->
    <select id="queryPlatformUserInfo" parameterType="java.lang.Long" resultMap="infoResultMap">
        SELECT
        user_id,
        ifk_code,
        user_name,
        gender,
        user_type,
        org_id,
        org_abbrname,
        school_id,
        school_name,
        score,
        grade_name,
        dan,
        photo,
        signature
        FROM
        v_platform
        WHERE
        1 = 1
        <if test="userId !=null and userId !=''">
            AND user_id = #{userId,jdbcType=BIGINT}
        </if>
        ORDER BY user_id DESC
    </select>
</mapper>